C51 COMPILER V9.56.0.0   MAIN                                                              12/21/2018 23:14:27 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Program Files\MDK\C51\BIN\C51.EXE main.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\STC8051_Detect
                    -ionSystem) DEBUG OBJECTEXTEND PRINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "sys.h"
   2          #include "uart.h"
   3          #include "DHT11.h"
   4          #include "lcd1602.h"
   5          #include "stc89c5xrc.h"
   6          
   7          u8 Global_LinkID;
   8          u8 Global_RevDataSize;
   9          DHT11Data_Type Global_DHT11Structure;
  10          sbit LED = P1^1;
  11          sbit Switch = P1^7;
  12          
  13          void Response_Process(char Request_Type);
  14          
  15          void main(void)
  16          {
  17   1        char Request_Type;
  18   1        char tmp[10];
  19   1        u8 temp;
  20   1        
  21   1        // 初始化LCD1602
  22   1        LCD1602_Init();
  23   1        // 初始化串口
  24   1        Uart_Init();
  25   1        // 初始化定时器0
  26   1        //Timer0_Init();
  27   1        // 开启全局中断
  28   1        EA = 0;
  29   1        
  30   1        LCD1602_DisplayString(3,1,"hello");
  31   1        
  32   1        //delay_ms(3000);
  33   1        Uart_SendString("AT+CIPMUX=1\r\n"); //使能TCP多连接
  34   1        delay_ms(100);
  35   1        Uart_SendString("AT+CIPSERVER=1,8000\r\n"); //建立TCP服务器,监听端口8000
  36   1        delay_ms(100);
  37   1        Uart_SendString("AT+CIPSTO=600\r\n"); //建立超时时间
  38   1        delay_ms(100);
  39   1        while(1)
  40   1        {
  41   2      //    if(Global_UartRev_Flag)
  42   2      //    {
  43   2      //      Global_UartRev_Flag = 0;  //复位接收标记
  44   2      //      Global_LinkID = Global_UartBuffer[7] - '0'; //获取请求的客户端ID
  45   2      //      Request_Type = Global_UartBuffer[11];   //获取请求类型
  46   2      //      Response_Process(Request_Type);
  47   2      //      Global_UartRev_Count = 0; //清除缓冲计数
  48   2      //      ES = 1;
  49   2      //    }
  50   2          temp = DHT11_ReadData(&Global_DHT11Structure);
  51   2          if(!temp)
  52   2          {
  53   3            my_itoa(Global_DHT11Structure.RH_H,tmp);
  54   3            Uart_SendString(tmp);
C51 COMPILER V9.56.0.0   MAIN                                                              12/21/2018 23:14:27 PAGE 2   

  55   3            Uart_SendChar('.');
  56   3            my_itoa(Global_DHT11Structure.RH_L,tmp);
  57   3            Uart_SendString(tmp);
  58   3            Uart_SendString("%\r\n");
  59   3            my_itoa(Global_DHT11Structure.T_H,tmp);
  60   3            Uart_SendString(tmp);
  61   3            Uart_SendChar('.');
  62   3            my_itoa(Global_DHT11Structure.T_L,tmp);
  63   3            Uart_SendString(tmp);
  64   3            Uart_SendString("*C\r\n");
  65   3          }
  66   2          delay_ms(2000);
  67   2      //    LCD1602_DisplayString(3,1,"hello");
  68   2        }
  69   1      }
*** WARNING C280 IN LINE 17 OF main.c: 'Request_Type': unreferenced local variable
  70          
  71          void Response_Process(char Request_Type)
  72          {
  73   1        char payload[10];
  74   1        
  75   1        if(Request_Type == 1)
  76   1        {
  77   2          payload[0] = 0x01;  //响应数据类型
  78   2          payload[1] = 0x01;  //湿度整数位
  79   2          payload[2] = 0x02;  //湿度小数位
  80   2          payload[3] = 0x03;  //温度整数位
  81   2          payload[4] = 0x04;  //温度小数位
  82   2          payload[5] = 0x88;  //温湿度校验位
  83   2          payload[6] = 0x00;  //填充字符'\0'
  84   2          Uart_SendString("AT+CIPSEND=");
  85   2          Uart_SendChar(Global_LinkID+'0');
  86   2          Uart_SendString(",6\r\n");
  87   2          delay_ms(50);
  88   2          Uart_SendString(payload);
  89   2        }
  90   1        else if(Request_Type == 2)
  91   1        {
  92   2          Switch = ~Switch;
  93   2          payload[0] = 0x01;  //响应数据类型
  94   2          if(Switch)
  95   2            payload[1] = 2;
  96   2          else
  97   2            payload[1] = 1;
  98   2          payload[2] = 0x00;  //填充字符'\0'
  99   2          Uart_SendString("AT+CIPSEND=");
 100   2          Uart_SendChar('0'+Global_LinkID);
 101   2          Uart_SendString(",2\r\n");
 102   2          delay_ms(50);
 103   2          Uart_SendString(payload);
 104   2        }
 105   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    343    ----
   CONSTANT SIZE    =     89    ----
   XDATA SIZE       =      7      22
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.56.0.0   MAIN                                                              12/21/2018 23:14:27 PAGE 3   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
