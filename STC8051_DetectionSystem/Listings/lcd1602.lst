C51 COMPILER V9.56.0.0   LCD1602                                                           12/21/2018 23:06:38 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE LCD1602
OBJECT MODULE PLACED IN .\Objects\lcd1602.obj
COMPILER INVOKED BY: D:\Program Files\MDK\C51\BIN\C51.EXE lcd1602.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\STC8051_Det
                    -ectionSystem) DEBUG OBJECTEXTEND PRINT(.\Listings\lcd1602.lst) TABS(2) OBJECT(.\Objects\lcd1602.obj)

line level    source

   1          #include "lcd1602.h"
   2          
   3          
   4          /**
   5           * 从LCD1602读取数据
   6           * @param   
   7           * @return 
   8           * @brief 
   9           **/
  10          uint8 LCD1602_ReadData(void)
  11          {
  12   1        LCD_RS = 1;
  13   1        LCD_RW = 1;
  14   1        LCD_EN = 0;
  15   1        LCD_EN = 0;
  16   1        LCD_DelayUs(200);
  17   1        LCD_EN = 1;
  18   1        
  19   1        return LCD_DATA;
  20   1      }
  21          
  22          /**
  23           * 检测LCD1602繁忙状态
  24           * @param   
  25           * @return 
  26           * @brief 
  27           **/
  28          uint8 LCD1602_ReadBusy(void)
  29          {
  30   1        LCD_DATA = 0xff;
  31   1        LCD_RS = 0;
  32   1        LCD_RW = 1;
  33   1        LCD_EN = 0;
  34   1        LCD_EN = 0;
  35   1        LCD_DelayUs(200);
  36   1        LCD_EN = 1;
  37   1        
  38   1        return (LCD_DATA & BUSY);
  39   1      }
  40          
  41          /**
  42           * 往LCD1602写指令
  43           * @param   
  44           * @return 
  45           * @brief 
  46           **/
  47          void LCD1602_WriteCmd(uint8 cmd, uint8 BusyFlag)
  48          {
  49   1        if(BusyFlag) while(LCD1602_ReadBusy());
  50   1        LCD_DATA = cmd;
  51   1        LCD_RS = 0;
  52   1        LCD_RW = 0;
  53   1        LCD_DelayUs(800);
  54   1        LCD_EN = 1;
C51 COMPILER V9.56.0.0   LCD1602                                                           12/21/2018 23:06:38 PAGE 2   

  55   1        LCD_DelayUs(800);
  56   1        LCD_EN = 0;
  57   1      }
  58          
  59          /**
  60           * 往LCD1602写数据
  61           * @param   
  62           * @return 
  63           * @brief 
  64           **/
  65          void LCD1602_WriteData(uint8 DisplayData)
  66          {
  67   1        //while(LCD1602_ReadBusy());
  68   1        LCD_DATA = DisplayData;
  69   1        LCD_RS = 1;
  70   1        LCD_RW = 0;
  71   1        LCD_DelayUs(800);
  72   1        LCD_EN = 1;
  73   1        LCD_DelayUs(800);
  74   1        LCD_EN = 0;
  75   1      }
  76          
  77          /**
  78           * 初始化LCD1602
  79           * @param   
  80           * @return 
  81           * @brief 
  82           **/
  83          void LCD1602_Init(void)
  84          {
  85   1        // 三次显示模式设置,不检测忙信号
  86   1        LCD1602_WriteCmd(0x38,0);
  87   1        LCD_DelayMs(5);
  88   1        LCD1602_WriteCmd(0x38,0);
  89   1        LCD_DelayMs(5);
  90   1        LCD1602_WriteCmd(0x38,0);
  91   1        LCD_DelayMs(5);
  92   1        
  93   1        LCD1602_WriteCmd(0x38,0); //显示模式设置
  94   1        LCD1602_WriteCmd(0x08,0); //关闭显示
  95   1        LCD1602_WriteCmd(0x01,0); //显示清屏
  96   1        LCD1602_WriteCmd(0x06,0); //显示光标移动设置
  97   1        LCD1602_WriteCmd(0x0c,0); //显示开及光标设置
  98   1        
  99   1      }
 100          
 101          /**
 102           * 在指定位置显示一个字符
 103           * @param   
 104           * @return 
 105           * @brief 
 106           **/
 107          void LCD1602_DisplayChar(uint8 x, uint8 y, uint8 DisplayChar)
 108          {
 109   1        // 限制x不能大于15, y不能大于1
 110   1        y &= 0x01;
 111   1        x &= 0x0f;
 112   1        // 当要显示第二行时地址码+0x40
 113   1        if(y) x |= 0x40;
 114   1        x |= 0x80;  //算出地址码
 115   1        LCD1602_WriteCmd(x,0);
 116   1        LCD1602_WriteData(DisplayChar);
C51 COMPILER V9.56.0.0   LCD1602                                                           12/21/2018 23:06:38 PAGE 3   

 117   1      }
 118          
 119          /**
 120           * 在指定位置开始显示字符串
 121           * @param   
 122           * @return 
 123           * @brief 
 124           **/
 125          void LCD1602_DisplayString(uint8 x, uint8 y, uint8 code *String)
 126          {
 127   1        uint8 length=0;
 128   1        
 129   1        // 限制x不能大于15, y不能大于1
 130   1        y &= 0x01;
 131   1        x &= 0x0f;
 132   1        // 若到达字符串尾则退出
 133   1        while(String[length]>=0x20)
 134   1        {
 135   2          if(x <= 0x0f)
 136   2          {
 137   3            LCD1602_DisplayChar(x,y,String[length]);
 138   3            length++;
 139   3            x++;
 140   3          }
 141   2        }
 142   1      }
 143          
 144          /**
 145           * 清屏
 146           * @param   
 147           * @return 
 148           * @brief 
 149           **/
 150          void LCD1602_Clear(void)
 151          {
 152   1        LCD1602_WriteCmd(0x01,0);
 153   1        LCD1602_WriteCmd(0x02,0);
 154   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    324    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       7
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
