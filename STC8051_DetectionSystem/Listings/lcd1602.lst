C51 COMPILER V9.56.0.0   LCD1602                                                           12/15/2018 17:18:59 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE LCD1602
OBJECT MODULE PLACED IN .\Objects\lcd1602.obj
COMPILER INVOKED BY: D:\Program Files\MDK\C51\BIN\C51.EXE lcd1602.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\STC8051_Detection
                    -System) DEBUG OBJECTEXTEND PRINT(.\Listings\lcd1602.lst) TABS(2) OBJECT(.\Objects\lcd1602.obj)

line level    source

   1          #include "lcd1602.h"
   2          
   3          
   4          /**
   5           * 从LCD1602读取数据
   6           * @param   
   7           * @return 
   8           * @brief 
   9           **/
  10          uint8 LCD1602_ReadData(void)
  11          {
  12   1        LCD_RS = 1;
  13   1        LCD_RW = 1;
  14   1        LCD_EN = 0;
  15   1        LCD_EN = 0;
  16   1        LCD_DelayUs(200);
  17   1        LCD_EN = 1;
  18   1        
  19   1        return LCD_DATA;
  20   1      }
  21          
  22          /**
  23           * 检测LCD1602繁忙状态
  24           * @param   
  25           * @return 
  26           * @brief 
  27           **/
  28          uint8 LCD1602_ReadBusy(void)
  29          {
  30   1        LCD_DATA = 0xff;
  31   1        LCD_RS = 0;
  32   1        LCD_RW = 1;
  33   1        LCD_EN = 0;
  34   1        LCD_EN = 0;
  35   1        LCD_DelayUs(200);
  36   1        LCD_EN = 1;
  37   1        
  38   1        return (LCD_DATA & BUSY);
  39   1      }
  40          
  41          /**
  42           * 往LCD1602写指令
  43           * @param   
  44           * @return 
  45           * @brief 
  46           **/
  47          void LCD1602_WriteCmd(uint8 cmd, uint8 BusyFlag)
  48          {
  49   1        if(BusyFlag) while(LCD1602_ReadBusy());
  50   1        LCD_DATA = cmd;
  51   1        LCD_RS = 0;
  52   1        LCD_RW = 0;
  53   1        LCD_EN = 0;
  54   1        LCD_EN = 0;
C51 COMPILER V9.56.0.0   LCD1602                                                           12/15/2018 17:18:59 PAGE 2   

  55   1        LCD_EN = 1;
  56   1        LCD_DelayUs(200);
  57   1        LCD_EN = 0;
  58   1      }
  59          
  60          /**
  61           * 往LCD1602写数据
  62           * @param   
  63           * @return 
  64           * @brief 
  65           **/
  66          void LCD1602_WriteData(uint8 DisplayData)
  67          {
  68   1        //while(LCD1602_ReadBusy());
  69   1        LCD_DATA = DisplayData;
  70   1        LCD_RS = 1;
  71   1        LCD_RW = 0;
  72   1        LCD_EN = 0;
  73   1        LCD_EN = 0;
  74   1        LCD_EN = 1;
  75   1        LCD_DelayUs(200);
  76   1        LCD_EN = 0;
  77   1      }
  78          
  79          /**
  80           * 初始化LCD1602
  81           * @param   
  82           * @return 
  83           * @brief 
  84           **/
  85          void LCD1602_Init(void)
  86          {
  87   1        LCD_DATA = 0;
  88   1        // 三次显示模式设置,不检测忙信号
  89   1        LCD1602_WriteCmd(0x38,0);
  90   1        LCD_DelayMs(5);
  91   1        LCD1602_WriteCmd(0x38,0);
  92   1        LCD_DelayMs(5);
  93   1        LCD1602_WriteCmd(0x38,0);
  94   1        LCD_DelayMs(5);
  95   1        
  96   1        LCD1602_WriteCmd(0x38,0); //显示模式设置
  97   1        LCD1602_WriteCmd(0x08,0); //关闭显示
  98   1        LCD1602_WriteCmd(0x01,0); //显示清屏
  99   1        LCD1602_WriteCmd(0x06,0); //显示光标移动设置
 100   1        LCD1602_WriteCmd(0x0c,0); //显示开及光标设置
 101   1        
 102   1      }
 103          
 104          /**
 105           * 在指定位置显示一个字符
 106           * @param   
 107           * @return 
 108           * @brief 
 109           **/
 110          void LCD1602_DisplayChar(uint8 x, uint8 y, uint8 DisplayChar)
 111          {
 112   1        // 限制x不能大于15, y不能大于1
 113   1        y &= 0x01;
 114   1        x &= 0x0f;
 115   1        // 当要显示第二行时地址码+0x40
 116   1        if(y) x |= 0x40;
C51 COMPILER V9.56.0.0   LCD1602                                                           12/15/2018 17:18:59 PAGE 3   

 117   1        x |= 0x80;  //算出地址码
 118   1        LCD1602_WriteCmd(x,0);
 119   1        LCD1602_WriteData(DisplayChar);
 120   1      }
 121          
 122          /**
 123           * 在指定位置开始显示字符串
 124           * @param   
 125           * @return 
 126           * @brief 
 127           **/
 128          void LCD1602_DisplayString(uint8 x, uint8 y, uint8 code *String)
 129          {
 130   1        uint8 length=0;
 131   1        
 132   1        // 限制x不能大于15, y不能大于1
 133   1        y &= 0x01;
 134   1        x &= 0x0f;
 135   1        // 若到达字符串尾则退出
 136   1        while(String[length]>=0x20)
 137   1        {
 138   2          if(x <= 0x0f)
 139   2          {
 140   3            LCD1602_DisplayChar(x,y,String[length]);
 141   3            length++;
 142   3            x++;
 143   3          }
 144   2        }
 145   1      }
 146          
 147          /**
 148           * 清屏
 149           * @param   
 150           * @return 
 151           * @brief 
 152           **/
 153          void LCD1602_Clear(void)
 154          {
 155   1        LCD1602_WriteCmd(0x01,0);
 156   1        LCD1602_WriteCmd(0x02,0);
 157   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    271    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       7
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
